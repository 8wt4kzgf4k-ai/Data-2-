<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EUR/USD 5-Min Streak Analysis</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background: #f4f4f4; }
  #loadingContainer { width: 100%; background: #eee; margin-top: 20px; height: 25px; border-radius: 5px; overflow: hidden; }
  #loadingBar { height: 100%; width: 0; background: #4caf50; text-align: center; color: white; line-height: 25px; }
</style>
</head>
<body>

<h2>EUR/USD 5-Minute Candle Streak Analysis</h2>

<div id="loadingContainer">
  <div id="loadingBar">0%</div>
</div>

<table id="resultsTable">
  <thead>
    <tr>
      <th>Streak Type</th>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Length</th>
      <th>AC Start</th>
      <th>AC End</th>
      <th>AC % Change</th>
      <th>AC per Candle</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const API_KEY = 'YOUR_TWELVE_DATA_API_KEY'; // Replace with your Twelve Data API Key
const SYMBOL = 'EUR/USD';
const INTERVAL = '5min';
const OUTPUT_SIZE = 100; // Adjust as needed, max is 800 for free plan
const MIN_STREAK = 3;

async function fetchCandleData() {
  const url = `https://api.twelvedata.com/time_series?symbol=${SYMBOL}&interval=${INTERVAL}&outputsize=${OUTPUT_SIZE}&apikey=${API_KEY}&format=JSON`;
  const response = await fetch(url);
  const data = await response.json();
  return data.values.reverse(); // reverse to chronological order
}

// Fake AC calculation for demo (replace with your API AC if available)
function calculateAC(candle) {
  // Accelerator Oscillator = Awesome Oscillator - SMA(5 of AO)
  // Here we simulate as random small variations
  return parseFloat((Math.random() * 0.01 - 0.005).toFixed(4));
}

function detectStreaks(candles) {
  const streaks = [];
  let currentStreak = [];
  let currentDir = null;

  candles.forEach((c, index) => {
    const close = parseFloat(c.close);
    const prevClose = index > 0 ? parseFloat(candles[index - 1].close) : close;

    const dir = close > prevClose ? 'Bull' : close < prevClose ? 'Bear' : 'Neutral';

    if (dir === currentDir && dir !== 'Neutral') {
      currentStreak.push(c);
    } else {
      if (currentStreak.length >= MIN_STREAK) streaks.push({ type: currentDir, candles: currentStreak });
      currentStreak = dir !== 'Neutral' ? [c] : [];
      currentDir = dir;
    }
  });

  if (currentStreak.length >= MIN_STREAK) streaks.push({ type: currentDir, candles: currentStreak });
  return streaks;
}

function calculateACStreaks(streaks) {
  return streaks.map(s => {
    const acValues = s.candles.map(c => calculateAC(c));
    const acStart = acValues[0];
    const acEnd = acValues[acValues.length - 1];
    const acChange = ((acEnd - acStart) / Math.abs(acStart || 1)) * 100;
    const acPerCandle = (acEnd - acStart) / s.candles.length;
    return {
      type: s.type,
      start: s.candles[0].datetime,
      end: s.candles[s.candles.length - 1].datetime,
      length: s.candles.length,
      acStart: acStart.toFixed(4),
      acEnd: acEnd.toFixed(4),
      acChange: acChange.toFixed(2),
      acPerCandle: acPerCandle.toFixed(4)
    };
  });
}

function updateTable(streakData) {
  const tbody = document.querySelector('#resultsTable tbody');
  tbody.innerHTML = '';
  streakData.forEach(s => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${s.type}</td>
      <td>${s.start}</td>
      <td>${s.end}</td>
      <td>${s.length}</td>
      <td>${s.acStart}</td>
      <td>${s.acEnd}</td>
      <td>${s.acChange}</td>
      <td>${s.acPerCandle}</td>
    `;
    tbody.appendChild(row);
  });
}

function updateLoading(progress, total) {
  const percent = Math.round((progress / total) * 100);
  const bar = document.getElementById('loadingBar');
  bar.style.width = percent + '%';
  bar.textContent = percent + '%';
}

async function main() {
  updateLoading(0, 1);
  const candles = await fetchCandleData();
  updateLoading(1, 1);

  const streaks = detectStreaks(candles);
  const streakAC = calculateACStreaks(streaks);
  updateTable(streakAC);
}

main();
</script>

</body>
</html>
